# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

jobs:

- job: 'ParallelBuildAndTesting'
  pool: 
    vmImage: 'Hosted VS2017'
  strategy:
    parallel: 3

  steps:
    - powershell: .\src\build.ps1 -Configuration Release
      displayName: Start Building The Module
      errorActionPreference: continue

    - powershell: .\src\UniversalDashboard.UITest\shebang.tests.ps1 -Release -Integration
      displayName: Start Integration Tests
      errorActionPreference: continue

    - task: PublishTestResults@2
      inputs:
        testResultsFormat: 'NUnit' # Options: JUnit, NUnit, VSTest, xUnit
        testResultsFiles: '**/*TEST-*.xml' 
        searchFolder: '$(System.DefaultWorkingDirectory)' # Optional
        #mergeTestResults: false # Optional
        testRunTitle: test-results/test-case.Attributes["name"].Value
        #buildPlatform: # Optional
        #buildConfiguration: # Optional
        publishRunAttachments: true # Optional

    - powershell: Compress-Archive -Path .\src\output -DestinationPath '$(System.DefaultWorkingDirectory)\output.zip' -Force
      displayName: Create OutPut Zip File
      errorActionPreference: continue
