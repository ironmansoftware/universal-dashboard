# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

jobs:

- job: 'ParallelBuildAndTesting'
  pool: 'Hosted VS2017'
  strategy:
    parallel: 3

  steps:
    - powershell: .\src\build.ps1 -Configuration Release
      displayName: Start Building The Module
      errorActionPreference: continue

    - powershell: .\src\UniversalDashboard.UITest\shebang.tests.ps1 -Release -Integration
      displayName: Start Integration Tests
      errorActionPreference: continue

    - task: PublishTestResults@2
      inputs:
        testResultsFormat: 'NUnit' # Options: JUnit, NUnit, VSTest, xUnit
        testResultsFiles: '**/*TEST-*.xml' 
        searchFolder: '$(System.DefaultWorkingDirectory)' # Optional
        mergeTestResults: true # Optional
        #testRunTitle: 
        #buildPlatform: # Optional
        #buildConfiguration: # Optional
        publishRunAttachments: true # Optional

    - powershell: Compress-Archive -Path .\src\output -DestinationPath $(Build.ArtifactStagingDirectory) -Force
      displayName: Create OutPut Zip File
      errorActionPreference: continue

    # Publish Pipeline Artifact
    - task: PublishPipelineArtifact@0
      inputs:
        artifactName: 'UniversalDashboard'
        targetPath: $(Build.ArtifactStagingDirectory)